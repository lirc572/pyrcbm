/* //////////////// generated by ulog2rcbm ////////////////
- filePrefix
- data -- [[timestamp_in_ms, pwm_output], [..., ...], ...]
- samplesAvg
- rampup
///////////// User defined variables //////////// */

const filePrefix = "sin_wave";
const data = [[0.0,1500],[0.025,1809],[0.05,1014],[0.075,1954],[0.1,1271],[0.125,1404],[0.15,1878],[0.175,1000],[0.2,1906],[0.225,1359],[0.25,1313],[0.275,1933],[0.3,1005],[0.325,1844],[0.35,1453],[0.375,1228],[0.4,1973],[0.425,1028],[0.45,1768],[0.475,1549],[0.5,1153],[0.525,1995],[0.55,1068],[0.575,1683],[0.6,1643],[0.625,1091],[0.65,1999],[0.675,1123],[0.7,1591],[0.725,1731],[0.75,1043],[0.775,1985],[0.8,1193],[0.825,1496],[0.85,1811],[0.875,1013],[0.9,1953],[0.925,1274],[0.95,1401],[0.975,1880],[1.0,1000],[1.025,1904],[1.05,1363],[1.075,1310],[1.1,1935],[1.125,1005],[1.15,1841],[1.175,1457],[1.2,1225],[1.225,1974],[1.25,1029],[1.275,1766],[1.3,1552],[1.325,1151],[1.35,1995],[1.375,1069],[1.4,1680],[1.425,1646],[1.45,1089],[1.475,1999],[1.5,1125],[1.525,1588],[1.55,1734],[1.575,1042],[1.6,1984],[1.625,1195],[1.65,1493],[1.675,1814],[1.7,1012],[1.725,1951],[1.75,1276],[1.775,1398],[1.8,1882],[1.825,1000],[1.85,1903],[1.875,1366],[1.9,1307],[1.925,1936],[1.95,1006],[1.975,1839],[2.0,1460],[2.025,1223],[2.05,1975],[2.075,1030],[2.1,1763],[2.125,1555],[2.15,1148],[2.175,1996],[2.2,1071],[2.225,1677],[2.25,1649],[2.275,1087],[2.3,1998],[2.325,1128],[2.35,1585],[2.375,1737],[2.4,1041],[2.425,1983],[2.45,1198],[2.475,1490],[2.5,1816],[2.525,1011],[2.55,1950],[2.575,1279],[2.6,1395],[2.625,1884],[2.65,1000],[2.675,1901],[2.7,1369],[2.725,1304],[2.75,1938],[2.775,1006],[2.8,1837],[2.825,1463],[2.85,1220],[2.875,1976],[2.9,1031],[2.925,1760],[2.95,1558],[2.975,1146],[3.0,1996],[3.025,1072],[3.05,1674],[3.075,1652],[3.1,1085],[3.125,1998],[3.15,1130],[3.175,1582],[3.2,1740],[3.225,1040],[3.25,1982],[3.275,1201],[3.3,1487],[3.325,1819],[3.35,1011],[3.375,1949],[3.4,1282],[3.425,1392],[3.45,1886],[3.475,1000],[3.5,1899],[3.525,1372],[3.55,1301],[3.575,1939],[3.6,1007],[3.625,1834],[3.65,1466],[3.675,1217],[3.7,1977],[3.725,1032],[3.75,1757],[3.775,1562],[3.8,1144],[3.825,1996],[3.85,1074],[3.875,1671],[3.9,1655],[3.925,1084],[3.95,1998],[3.975,1132],[4.0,1579],[4.025,1742],[4.05,1038],[4.075,1981],[4.1,1203],[4.125,1483],[4.15,1821],[4.175,1010],[4.2,1947],[4.225,1285],[4.25,1389],[4.275,1888],[4.3,1000],[4.325,1897],[4.35,1375],[4.375,1298],[4.4,1941],[4.425,1007],[4.45,1832],[4.475,1469],[4.5,1215],[4.525,1977],[4.55,1033],[4.575,1755],[4.6,1565],[4.625,1142],[4.65,1997],[4.675,1076],[4.7,1668],[4.725,1658],[4.75,1082],[4.775,1998],[4.8,1134],[4.825,1576],[4.85,1745],[4.875,1037],[4.9,1981],[4.925,1206],[4.95,1480],[4.975,1824],[5.0,1009],[5.025,1946],[5.05,1288],[5.075,1386],[5.1,1890],[5.125,1000],[5.15,1895],[5.175,1378],[5.2,1295],[5.225,1942],[5.25,1008],[5.275,1829],[5.3,1472],[5.325,1212],[5.35,1978],[5.375,1034],[5.4,1752],[5.425,1568],[5.45,1139],[5.475,1997],[5.5,1078],[5.525,1665],[5.55,1661],[5.575,1080],[5.6,1997],[5.625,1136],[5.65,1572],[5.675,1748],[5.7,1036],[5.725,1980],[5.75,1208],[5.775,1477],[5.8,1826],[5.825,1009],[5.85,1944],[5.875,1291],[5.9,1382],[5.925,1892],[5.95,1000],[5.975,1893],[6.0,1381],[6.025,1292],[6.05,1944],[6.075,1008],[6.1,1827],[6.125,1476],[6.15,1209],[6.175,1979],[6.2,1035],[6.225,1749],[6.25,1571],[6.275,1137],[6.3,1997],[6.325,1079],[6.35,1662],[6.375,1664],[6.4,1078],[6.425,1997],[6.45,1138],[6.475,1569],[6.5,1751],[6.525,1035],[6.55,1979],[6.575,1211],[6.6,1474],[6.625,1828],[6.65,1008],[6.675,1943],[6.7,1294],[6.725,1379],[6.75,1894],[6.775,1000],[6.8,1891],[6.825,1384],[6.85,1289],[6.875,1945],[6.9,1009],[6.925,1825],[6.95,1479],[6.975,1207],[7.0,1980],[7.025,1037],[7.05,1746],[7.075,1574],[7.1,1135],[7.125,1998],[7.15,1081],[7.175,1659],[7.2,1667],[7.225,1077],[7.25,1997],[7.275,1141],[7.3,1566],[7.325,1754],[7.35,1034],[7.375,1978],[7.4,1214],[7.425,1471],[7.45,1831],[7.475,1008],[7.5,1941],[7.525,1297],[7.55,1376],[7.575,1896],[7.6,1000],[7.625,1889],[7.65,1387],[7.675,1286],[7.7,1947],[7.725,1010],[7.75,1822],[7.775,1482],[7.8,1204],[7.825,1981],[7.85,1038],[7.875,1744],[7.9,1577],[7.925,1133],[7.95,1998],[7.975,1083],[8.0,1656],[8.025,1670],[8.05,1075],[8.075,1996],[8.1,1143],[8.125,1563],[8.15,1756],[8.175,1032],[8.2,1977],[8.225,1216],[8.25,1467],[8.275,1833],[8.3,1007],[8.325,1940],[8.35,1300],[8.375,1373],[8.4,1898],[8.425,1000],[8.45,1887],[8.475,1391],[8.5,1283],[8.525,1948],[8.55,1010],[8.575,1820],[8.6,1485],[8.625,1202],[8.65,1982],[8.675,1039],[8.7,1741],[8.725,1581],[8.75,1131],[8.775,1998],[8.8,1085],[8.825,1653],[8.85,1673],[8.875,1073],[8.9,1996],[8.925,1145],[8.95,1560],[8.975,1759],[9.0,1031],[9.025,1976],[9.05,1219],[9.075,1464],[9.1,1836],[9.125,1006],[9.15,1938],[9.175,1303],[9.2,1370],[9.225,1900],[9.25,1000],[9.275,1885],[9.3,1394],[9.325,1281],[9.35,1950],[9.375,1011],[9.4,1817],[9.425,1489],[9.45,1199],[9.475,1983],[9.5,1040],[9.525,1738],[9.55,1584],[9.575,1129],[9.6,1998],[9.625,1086],[9.65,1650],[9.675,1676],[9.7,1072],[9.725,1996],[9.75,1147],[9.775,1557],[9.8,1762],[9.825,1030],[9.85,1975],[9.875,1221],[9.9,1461],[9.925,1838],[9.95,1006],[9.975,1937],[10.0,1306],[10.025,1367],[10.05,1902],[10.075,1000],[10.1,1883],[10.125,1397],[10.15,1278],[10.175,1951],[10.2,1012],[10.225,1815],[10.25,1492],[10.275,1197],[10.3,1984],[10.325,1042],[10.35,1735],[10.375,1587],[10.4,1126],[10.425,1999],[10.45,1088],[10.475,1647],[10.5,1679],[10.525,1070],[10.55,1995],[10.575,1150],[10.6,1553],[10.625,1764],[10.65,1029],[10.675,1974],[10.7,1224],[10.725,1458],[10.75,1840],[10.775,1005],[10.8,1935],[10.825,1309],[10.85,1364],[10.875,1904],[10.9,1000],[10.925,1881],[10.95,1400],[10.975,1275],[11.0,1952],[11.025,1012],[11.05,1812],[11.075,1495],[11.1,1194],[11.125,1984],[11.15,1043],[11.175,1732],[11.2,1590],[11.225,1124],[11.25,1999],[11.275,1090],[11.3,1644],[11.325,1682],[11.35,1068],[11.375,1995],[11.4,1152],[11.425,1550],[11.45,1767],[11.475,1028],[11.5,1973],[11.525,1227],[11.55,1455],[11.575,1843],[11.6,1005],[11.625,1934],[11.65,1311],[11.675,1361],[11.7,1906],[11.725,1000],[11.75,1879],[11.775,1403],[11.8,1272],[11.825,1954],[11.85,1013],[11.875,1810],[11.9,1498],[11.925,1191],[11.95,1985],[11.975,1044],[12.0,1729],[12.025,1593],[12.05,1122],[12.075,1999],[12.1,1092],[12.125,1641],[12.15,1685],[12.175,1067],[12.2,1994],[12.225,1154],[12.25,1547],[12.275,1770],[12.3,1027],[12.325,1972],[12.35,1229],[12.375,1452],[12.4,1845],[12.425,1004],[12.45,1932],[12.475,1314],[12.5,1358],[12.525,1907],[12.55,1000],[12.575,1877],[12.6,1406],[12.625,1269],[12.65,1955],[12.675,1014],[12.7,1807],[12.725,1501],[12.75,1189],[12.775,1986],[12.8,1046],[12.825,1727],[12.85,1596],[12.875,1120],[12.9,1999],[12.925,1094],[12.95,1638],[12.975,1688],[13.0,1065],[13.025,1994],[13.05,1157],[13.075,1544],[13.1,1773],[13.125,1026],[13.15,1971],[13.175,1232],[13.2,1448],[13.225,1847],[13.25,1004],[13.275,1931],[13.3,1317],[13.325,1355],[13.35,1909],[13.375,1000],[13.4,1874],[13.425,1409],[13.45,1266],[13.475,1956],[13.5,1015],[13.525,1805],[13.55,1505],[13.575,1186],[13.6,1987],[13.625,1047],[13.65,1724],[13.675,1600],[13.7,1118],[13.725,1999],[13.75,1096],[13.775,1635],[13.8,1691],[13.825,1063],[13.85,1993],[13.875,1159],[13.9,1541],[13.925,1775],[13.95,1025],[13.975,1970],[14.0,1235],[14.025,1445],[14.05,1850],[14.075,1004],[14.1,1929],[14.125,1320],[14.15,1352],[14.175,1911],[14.2,1000],[14.225,1872],[14.25,1412],[14.275,1263],[14.3,1958],[14.325,1016],[14.35,1802],[14.375,1508],[14.4,1184],[14.425,1987],[14.45,1048],[14.475,1721],[14.5,1603],[14.525,1116],[14.55,1999],[14.575,1098],[14.6,1632],[14.625,1694],[14.65,1062],[14.675,1993],[14.7,1161],[14.725,1537],[14.75,1778],[14.775,1024],[14.8,1969],[14.825,1238],[14.85,1442],[14.875,1852],[14.9,1003],[14.925,1927],[14.95,1323],[14.975,1349],[15.0,1913],[15.025,1001],[15.05,1870],[15.075,1416],[15.1,1261],[15.125,1959],[15.15,1016],[15.175,1800],[15.2,1511],[15.225,1181],[15.25,1988],[15.275,1050],[15.3,1718],[15.325,1606],[15.35,1114],[15.375,1999],[15.4,1099],[15.425,1629],[15.45,1697],[15.475,1060],[15.5,1992],[15.525,1164],[15.55,1534],[15.575,1781],[15.6,1023],[15.625,1968],[15.65,1240],[15.675,1439],[15.7,1854],[15.725,1003],[15.75,1926],[15.775,1326],[15.8,1345],[15.825,1915],[15.85,1001],[15.875,1868],[15.9,1419],[15.925,1258],[15.95,1960],[15.975,1017],[16.0,1797],[16.025,1514],[16.05,1179],[16.075,1989],[16.1,1051],[16.125,1715],[16.15,1609],[16.175,1112],[16.2,1999],[16.225,1101],[16.25,1625],[16.275,1700],[16.3,1059],[16.325,1992],[16.35,1166],[16.375,1531],[16.4,1783],[16.425,1022],[16.45,1966],[16.475,1243],[16.5,1436],[16.525,1856],[16.55,1002],[16.575,1924],[16.6,1329],[16.625,1342],[16.65,1916],[16.675,1001],[16.7,1866],[16.725,1422],[16.75,1255],[16.775,1961],[16.8,1018],[16.825,1794],[16.85,1517],[16.875,1177],[16.9,1989],[16.925,1053],[16.95,1712],[16.975,1612],[17.0,1110],[17.025,1999],[17.05,1103],[17.075,1622],[17.1,1703],[17.125,1057],[17.15,1991],[17.175,1169],[17.2,1528],[17.225,1786],[17.25,1021],[17.275,1965],[17.3,1246],[17.325,1432],[17.35,1859],[17.375,1002],[17.4,1922],[17.425,1332],[17.45,1339],[17.475,1918],[17.5,1001],[17.525,1864],[17.55,1425],[17.575,1252],[17.6,1963],[17.625,1019],[17.65,1792],[17.675,1521],[17.7,1174],[17.725,1990],[17.75,1054],[17.775,1709],[17.8,1615],[17.825,1108],[17.85,1999],[17.875,1105],[17.9,1619],[17.925,1706],[17.95,1056],[17.975,1991],[18.0,1171],[18.025,1525],[18.05,1788],[18.075,1020],[18.1,1964],[18.125,1249],[18.15,1429],[18.175,1861],[18.2,1002],[18.225,1920],[18.25,1335],[18.275,1336],[18.3,1920],[18.325,1002],[18.35,1861],[18.375,1428],[18.4,1249],[18.425,1964],[18.45,1020],[18.475,1789],[18.5,1524],[18.525,1172],[18.55,1991],[18.575,1055],[18.6,1706],[18.625,1618],[18.65,1106],[18.675,1999],[18.7,1107],[18.725,1616],[18.75,1709],[18.775,1054],[18.8,1990],[18.825,1173],[18.85,1521],[18.875,1791],[18.9,1019],[18.925,1963],[18.95,1251],[18.975,1426],[19.0,1863],[19.025,1002],[19.05,1919],[19.075,1339],[19.1,1333],[19.125,1922],[19.15,1002],[19.175,1859],[19.2,1431],[19.225,1247],[19.25,1965],[19.275,1021],[19.3,1787],[19.325,1527],[19.35,1169],[19.375,1991],[19.4,1057],[19.425,1704],[19.45,1621],[19.475,1104],[19.5,1999],[19.525,1109],[19.55,1613],[19.575,1711],[19.6,1053],[19.625,1990],[19.65,1176],[19.675,1518],[19.7,1794],[19.725,1018],[19.75,1962],[19.775,1254],[19.8,1423],[19.825,1865],[19.85,1001],[19.875,1917],[19.9,1342],[19.925,1330],[19.95,1923],[19.975,1002]];
const samplesAvg = 20;
const rampup = false;

let lastTimestamp = data[0][0];
let position = 0; // index of data array
let timeDifference;

///////////////// Beginning of the script //////////////////

if (!data) {
    rcb.console.print("Error: data is not an array of length > 0");
    rcb.endScript();
}

rcb.files.newLogFile({prefix: filePrefix});

rcb.wait(readSensor, lastTimestamp);
function readSensor() {
    rcb.console.setVerbose(false);
    rcb.sensors.read(readDone, samplesAvg);
    rcb.console.setVerbose(true);
}
function readDone(result) {
    rcb.console.setVerbose(false);
    rcb.files.newLogEntry(result, readSensor);
    rcb.console.setVerbose(true);
}

rcb.console.print("Starting...");
rcb.console.setVerbose(true);

if (rampup) {
    rcb.console.print("Ramping Up...");
    rcb.output.ramp("esc", 1000, data[0][1], lastTimestamp > 1 ? lastTimestamp : 1, callback); // ramp up to data[0][1] in data[0][0] or 1 sec, whichever is larger
} else {
    rcb.wait(callback, lastTimestamp);
}

function callback() {
    rcb.output.set("esc", data[position][1]);
    position++;
    if (data.length > position) {
        timeDifference = data[position][0] - lastTimestamp;
        lastTimestamp = data[position][0];
        rcb.wait(callback, timeDifference);
    } else {
        rcb.wait(function() {
            rcb.endScript();
        }, 1000);
    }
}
