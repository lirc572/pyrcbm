/* //////////////// generated by ulog2rcbm ////////////////
- filePrefix
- data -- [[timestamp_in_ms, pwm_output], [..., ...], ...]
- samplesAvg
- rampup
///////////// User defined variables //////////// */

const filePrefix = "sin_wave";
const data = [[0.0,1498],[0.025,1510],[0.05,1523],[0.075,1535],[0.1,1548],[0.125,1560],[0.15,1573],[0.175,1585],[0.2,1597],[0.225,1610],[0.25,1622],[0.275,1634],[0.3,1646],[0.325,1658],[0.35,1669],[0.375,1681],[0.4,1693],[0.425,1704],[0.45,1716],[0.475,1727],[0.5,1738],[0.525,1749],[0.55,1759],[0.575,1770],[0.6,1781],[0.625,1791],[0.65,1801],[0.675,1811],[0.7,1820],[0.725,1830],[0.75,1839],[0.775,1848],[0.8,1857],[0.825,1866],[0.85,1874],[0.875,1882],[0.9,1890],[0.925,1898],[0.95,1905],[0.975,1912],[1.0,1919],[1.025,1926],[1.05,1932],[1.075,1939],[1.1,1944],[1.125,1950],[1.15,1955],[1.175,1960],[1.2,1965],[1.225,1969],[1.25,1973],[1.275,1977],[1.3,1981],[1.325,1984],[1.35,1987],[1.375,1990],[1.4,1992],[1.425,1994],[1.45,1996],[1.475,1997],[1.5,1998],[1.525,1999],[1.55,1999],[1.575,1999],[1.6,1999],[1.625,1999],[1.65,1998],[1.675,1997],[1.7,1996],[1.725,1994],[1.75,1992],[1.775,1989],[1.8,1987],[1.825,1984],[1.85,1981],[1.875,1977],[1.9,1973],[1.925,1969],[1.95,1965],[1.975,1960],[2.0,1955],[2.025,1950],[2.05,1944],[2.075,1938],[2.1,1932],[2.125,1925],[2.15,1919],[2.175,1912],[2.2,1905],[2.225,1897],[2.25,1890],[2.275,1882],[2.3,1873],[2.325,1865],[2.35,1856],[2.375,1847],[2.4,1838],[2.425,1829],[2.45,1820],[2.475,1810],[2.5,1800],[2.525,1790],[2.55,1780],[2.575,1769],[2.6,1759],[2.625,1748],[2.65,1737],[2.675,1726],[2.7,1715],[2.725,1703],[2.75,1692],[2.775,1680],[2.8,1668],[2.825,1657],[2.85,1645],[2.875,1633],[2.9,1621],[2.925,1609],[2.95,1596],[2.975,1584],[3.0,1572],[3.025,1559],[3.05,1547],[3.075,1534],[3.1,1522],[3.125,1509],[3.15,1497],[3.175,1484],[3.2,1472],[3.225,1459],[3.25,1447],[3.275,1435],[3.3,1422],[3.325,1410],[3.35,1398],[3.375,1385],[3.4,1373],[3.425,1361],[3.45,1349],[3.475,1337],[3.5,1326],[3.525,1314],[3.55,1302],[3.575,1291],[3.6,1280],[3.625,1269],[3.65,1257],[3.675,1247],[3.7,1236],[3.725,1225],[3.75,1215],[3.775,1205],[3.8,1195],[3.825,1185],[3.85,1175],[3.875,1166],[3.9,1157],[3.925,1148],[3.95,1139],[3.975,1130],[4.0,1122],[4.025,1114],[4.05,1106],[4.075,1099],[4.1,1091],[4.125,1084],[4.15,1077],[4.175,1071],[4.2,1064],[4.225,1058],[4.25,1053],[4.275,1047],[4.3,1042],[4.325,1037],[4.35,1033],[4.375,1028],[4.4,1024],[4.425,1020],[4.45,1017],[4.475,1014],[4.5,1011],[4.525,1009],[4.55,1006],[4.575,1004],[4.6,1003],[4.625,1002],[4.65,1001],[4.675,1000],[4.7,1000],[4.725,1000],[4.75,1000],[4.775,1000],[4.8,1001],[4.825,1002],[4.85,1004],[4.875,1006],[4.9,1008],[4.925,1010],[4.95,1013],[4.975,1016],[5.0,1020],[5.025,1023],[5.05,1027],[5.075,1031],[5.1,1036],[5.125,1041],[5.15,1046],[5.175,1051],[5.2,1057],[5.225,1063],[5.25,1069],[5.275,1076],[5.3,1082],[5.325,1090],[5.35,1097],[5.375,1104],[5.4,1112],[5.425,1120],[5.45,1128],[5.475,1137],[5.5,1146],[5.525,1155],[5.55,1164],[5.575,1173],[5.6,1183],[5.625,1192],[5.65,1202],[5.675,1213],[5.7,1223],[5.725,1233],[5.75,1244],[5.775,1255],[5.8,1266],[5.825,1277],[5.85,1288],[5.875,1300],[5.9,1311],[5.925,1323],[5.95,1334],[5.975,1346],[6.0,1358],[6.025,1370],[6.05,1382],[6.075,1395],[6.1,1407],[6.125,1419],[6.15,1432],[6.175,1444],[6.2,1456],[6.225,1469],[6.25,1481],[6.275,1494],[6.3,1506],[6.325,1519],[6.35,1531],[6.375,1544],[6.4,1556],[6.425,1569],[6.45,1581],[6.475,1593],[6.5,1606],[6.525,1618],[6.55,1630],[6.575,1642],[6.6,1654],[6.625,1666],[6.65,1677],[6.675,1689],[6.7,1700],[6.725,1712],[6.75,1723],[6.775,1734],[6.8,1745],[6.825,1756],[6.85,1767],[6.875,1777],[6.9,1787],[6.925,1798],[6.95,1807],[6.975,1817],[7.0,1827],[7.025,1836],[7.05,1845],[7.075,1854],[7.1,1863],[7.125,1871],[7.15,1880],[7.175,1888],[7.2,1895],[7.225,1903],[7.25,1910],[7.275,1917],[7.3,1924],[7.325,1930],[7.35,1937],[7.375,1942],[7.4,1948],[7.425,1954],[7.45,1959],[7.475,1963],[7.5,1968],[7.525,1972],[7.55,1976],[7.575,1980],[7.6,1983],[7.625,1986],[7.65,1989],[7.675,1991],[7.7,1993],[7.725,1995],[7.75,1997],[7.775,1998],[7.8,1999],[7.825,1999],[7.85,1999],[7.875,1999],[7.9,1999],[7.925,1998],[7.95,1997],[7.975,1996],[8.0,1994],[8.025,1992],[8.05,1990],[8.075,1988],[8.1,1985],[8.125,1982],[8.15,1978],[8.175,1974],[8.2,1970],[8.225,1966],[8.25,1961],[8.275,1956],[8.3,1951],[8.325,1946],[8.35,1940],[8.375,1934],[8.4,1928],[8.425,1921],[8.45,1914],[8.475,1907],[8.5,1900],[8.525,1892],[8.55,1884],[8.575,1876],[8.6,1868],[8.625,1859],[8.65,1850],[8.675,1841],[8.7,1832],[8.725,1823],[8.75,1813],[8.775,1803],[8.8,1793],[8.825,1783],[8.85,1773],[8.875,1762],[8.9,1751],[8.925,1741],[8.95,1729],[8.975,1718],[9.0,1707],[9.025,1696],[9.05,1684],[9.075,1672],[9.1,1661],[9.125,1649],[9.15,1637],[9.175,1625],[9.2,1612],[9.225,1600],[9.25,1588],[9.275,1576],[9.3,1563],[9.325,1551],[9.35,1538],[9.375,1526],[9.4,1513],[9.425,1501],[9.45,1488],[9.475,1476],[9.5,1464],[9.525,1451],[9.55,1439],[9.575,1426],[9.6,1414],[9.625,1402],[9.65,1389],[9.675,1377],[9.7,1365],[9.725,1353],[9.75,1341],[9.775,1329],[9.8,1318],[9.825,1306],[9.85,1295],[9.875,1283],[9.9,1272],[9.925,1261],[9.95,1250],[9.975,1239],[10.0,1229],[10.025,1218],[10.05,1208],[10.075,1198],[10.1,1188],[10.125,1179],[10.15,1169],[10.175,1160],[10.2,1151],[10.225,1142],[10.25,1133],[10.275,1125],[10.3,1117],[10.325,1109],[10.35,1101],[10.375,1094],[10.4,1086],[10.425,1080],[10.45,1073],[10.475,1067],[10.5,1060],[10.525,1055],[10.55,1049],[10.575,1044],[10.6,1039],[10.625,1034],[10.65,1030],[10.675,1025],[10.7,1022],[10.725,1018],[10.75,1015],[10.775,1012],[10.8,1009],[10.825,1007],[10.85,1005],[10.875,1003],[10.9,1002],[10.925,1001],[10.95,1000],[10.975,1000],[11.0,1000],[11.025,1000],[11.05,1000],[11.075,1001],[11.1,1002],[11.125,1003],[11.15,1005],[11.175,1007],[11.2,1010],[11.225,1012],[11.25,1015],[11.275,1018],[11.3,1022],[11.325,1026],[11.35,1030],[11.375,1034],[11.4,1039],[11.425,1044],[11.45,1050],[11.475,1055],[11.5,1061],[11.525,1067],[11.55,1074],[11.575,1080],[11.6,1087],[11.625,1094],[11.65,1102],[11.675,1110],[11.7,1117],[11.725,1126],[11.75,1134],[11.775,1143],[11.8,1152],[11.825,1161],[11.85,1170],[11.875,1179],[11.9,1189],[11.925,1199],[11.95,1209],[11.975,1219],[12.0,1230],[12.025,1240],[12.05,1251],[12.075,1262],[12.1,1273],[12.125,1284],[12.15,1296],[12.175,1307],[12.2,1319],[12.225,1331],[12.25,1342],[12.275,1354],[12.3,1366],[12.325,1378],[12.35,1391],[12.375,1403],[12.4,1415],[12.425,1427],[12.45,1440],[12.475,1452],[12.5,1465],[12.525,1477],[12.55,1490],[12.575,1502],[12.6,1515],[12.625,1527],[12.65,1540],[12.675,1552],[12.7,1565],[12.725,1577],[12.75,1589],[12.775,1602],[12.8,1614],[12.825,1626],[12.85,1638],[12.875,1650],[12.9,1662],[12.925,1674],[12.95,1685],[12.975,1697],[13.0,1708],[13.025,1719],[13.05,1731],[13.075,1742],[13.1,1752],[13.125,1763],[13.15,1774],[13.175,1784],[13.2,1794],[13.225,1804],[13.25,1814],[13.275,1824],[13.3,1833],[13.325,1842],[13.35,1851],[13.375,1860],[13.4,1869],[13.425,1877],[13.45,1885],[13.475,1893],[13.5,1900],[13.525,1908],[13.55,1915],[13.575,1922],[13.6,1928],[13.625,1935],[13.65,1941],[13.675,1946],[13.7,1952],[13.725,1957],[13.75,1962],[13.775,1966],[13.8,1971],[13.825,1975],[13.85,1979],[13.875,1982],[13.9,1985],[13.925,1988],[13.95,1990],[13.975,1993],[14.0,1995],[14.025,1996],[14.05,1997],[14.075,1998],[14.1,1999],[14.125,1999],[14.15,1999],[14.175,1999],[14.2,1999],[14.225,1998],[14.25,1996],[14.275,1995],[14.3,1993],[14.325,1991],[14.35,1989],[14.375,1986],[14.4,1983],[14.425,1979],[14.45,1976],[14.475,1972],[14.5,1968],[14.525,1963],[14.55,1958],[14.575,1953],[14.6,1948],[14.625,1942],[14.65,1936],[14.675,1930],[14.7,1923],[14.725,1916],[14.75,1909],[14.775,1902],[14.8,1895],[14.825,1887],[14.85,1879],[14.875,1871],[14.9,1862],[14.925,1853],[14.95,1844],[14.975,1835],[15.0,1826],[15.025,1816],[15.05,1807],[15.075,1797],[15.1,1786],[15.125,1776],[15.15,1766],[15.175,1755],[15.2,1744],[15.225,1733],[15.25,1722],[15.275,1711],[15.3,1699],[15.325,1688],[15.35,1676],[15.375,1664],[15.4,1653],[15.425,1641],[15.45,1629],[15.475,1616],[15.5,1604],[15.525,1592],[15.55,1580],[15.575,1567],[15.6,1555],[15.625,1543],[15.65,1530],[15.675,1518],[15.7,1505],[15.725,1493],[15.75,1480],[15.775,1468],[15.8,1455],[15.825,1443],[15.85,1430],[15.875,1418],[15.9,1406],[15.925,1393],[15.95,1381],[15.975,1369],[16.0,1357],[16.025,1345],[16.05,1333],[16.075,1322],[16.1,1310],[16.125,1298],[16.15,1287],[16.175,1276],[16.2,1265],[16.225,1254],[16.25,1243],[16.275,1232],[16.3,1222],[16.325,1211],[16.35,1201],[16.375,1191],[16.4,1182],[16.425,1172],[16.45,1163],[16.475,1154],[16.5,1145],[16.525,1136],[16.55,1128],[16.575,1119],[16.6,1111],[16.625,1104],[16.65,1096],[16.675,1089],[16.7,1082],[16.725,1075],[16.75,1069],[16.775,1062],[16.8,1056],[16.825,1051],[16.85,1045],[16.875,1040],[16.9,1036],[16.925,1031],[16.95,1027],[16.975,1023],[17.0,1019],[17.025,1016],[17.05,1013],[17.075,1010],[17.1,1008],[17.125,1006],[17.15,1004],[17.175,1002],[17.2,1001],[17.225,1000],[17.25,1000],[17.275,1000],[17.3,1000],[17.325,1000],[17.35,1001],[17.375,1002],[17.4,1003],[17.425,1005],[17.45,1007],[17.475,1009],[17.5,1011],[17.525,1014],[17.55,1017],[17.575,1021],[17.6,1025],[17.625,1029],[17.65,1033],[17.675,1038],[17.7,1043],[17.725,1048],[17.75,1053],[17.775,1059],[17.8,1065],[17.825,1071],[17.85,1078],[17.875,1085],[17.9,1092],[17.925,1099],[17.95,1107],[17.975,1115],[18.0,1123],[18.025,1131],[18.05,1140],[18.075,1149],[18.1,1158],[18.125,1167],[18.15,1176],[18.175,1186],[18.2,1196],[18.225,1206],[18.25,1216],[18.275,1226],[18.3,1237],[18.325,1248],[18.35,1259],[18.375,1270],[18.4,1281],[18.425,1292],[18.45,1304],[18.475,1315],[18.5,1327],[18.525,1339],[18.55,1350],[18.575,1362],[18.6,1374],[18.625,1387],[18.65,1399],[18.675,1411],[18.7,1423],[18.725,1436],[18.75,1448],[18.775,1461],[18.8,1473],[18.825,1486],[18.85,1498],[18.875,1511],[18.9,1523],[18.925,1536],[18.95,1548],[18.975,1560],[19.0,1573],[19.025,1585],[19.05,1597],[19.075,1610],[19.1,1622],[19.125,1634],[19.15,1646],[19.175,1658],[19.2,1670],[19.225,1681],[19.25,1693],[19.275,1704],[19.3,1716],[19.325,1727],[19.35,1738],[19.375,1749],[19.4,1760],[19.425,1770],[19.45,1781],[19.475,1791],[19.5,1801],[19.525,1811],[19.55,1821],[19.575,1830],[19.6,1839],[19.625,1848],[19.65,1857],[19.675,1866],[19.7,1874],[19.725,1882],[19.75,1890],[19.775,1898],[19.8,1905],[19.825,1913],[19.85,1919],[19.875,1926],[19.9,1933],[19.925,1939],[19.95,1944],[19.975,1950]];
const samplesAvg = 20;
const rampup = false;

let lastTimestamp = data[0][0];
let position = 0; // index of data array
let timeDifference;

///////////////// Beginning of the script //////////////////

if (!data) {
    rcb.console.print("Error: data is not an array of length > 0");
    rcb.endScript();
}

rcb.files.newLogFile({prefix: filePrefix});

rcb.wait(readSensor, lastTimestamp);
function readSensor() {
    rcb.console.setVerbose(false);
    rcb.sensors.read(readDone, samplesAvg);
    rcb.console.setVerbose(true);
}
function readDone(result) {
    rcb.console.setVerbose(false);
    rcb.files.newLogEntry(result, readSensor);
    rcb.console.setVerbose(true);
}

rcb.console.print("Starting...");
rcb.console.setVerbose(true);

if (rampup) {
    rcb.console.print("Ramping Up...");
    rcb.output.ramp("esc", 1000, data[0][1], lastTimestamp > 1 ? lastTimestamp : 1, callback); // ramp up to data[0][1] in data[0][0] or 1 sec, whichever is larger
} else {
    rcb.wait(callback, lastTimestamp);
}

function callback() {
    rcb.output.set("esc", data[position][1]);
    position++;
    if (data.length > position) {
        timeDifference = data[position][0] - lastTimestamp;
        lastTimestamp = data[position][0];
        rcb.wait(callback, timeDifference);
    } else {
        rcb.wait(function() {
            rcb.endScript();
        }, 1000);
    }
}
